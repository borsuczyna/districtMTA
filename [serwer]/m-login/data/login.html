<style>
    #login {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #login .login-panel {
        background: #1e1e1e;
        color: white;
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 0.8rem;
    }

    #login #login-panel.go-hide {
        opacity: 0;
        animation: hide-panel 0.5s;
    }

    @keyframes hide-panel {
        0% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        100% {
            opacity: 0;
            transform: scale(0.1) translateY(100%);
        }
    }

    #login .logo {
        display: flex;
        text-wrap: nowrap;
        gap: 0.313rem;
        align-items: center;
        font-weight: 500;
        font-size: 2.5rem;
        color: rgba(255, 255, 255, 0.85);
    }

    #login .gradient-text {
        margin-left: 0.313rem;
        font-weight: 800;
        background: linear-gradient(90deg, #ffab48 0.01%, #ffb762 21.88%, #fc8c5b 44.06%, #dc604f 70%, #ffab48 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% 200%;
        animation: gradient 3s linear infinite;
    }
    
    #login .text-glow {
        filter: blur(1.875rem);
        position: absolute;
        transform: translateX(-100%);
    }

    #login .text-glow-bit {
        filter: blur(1.25rem);
        position: absolute;
        opacity: 0.4;
        transform: translateX(-100%);
    }

    #login .update {
        background-color: #1e1e1e;
        width: 45rem;
        max-width: calc(100vw - 30rem);
        min-height: 100%;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1.6rem;
        overflow: hidden;
        padding-block: 0.4rem;
        position: relative;
    }

    #login .update .image {
        background-size: cover;
        background-position: center;
        transition: opacity 0.5s;
    }

    #login .update .vignette {
        background: radial-gradient(circle, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.75) 100%);
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: end;
        align-items: start;
        padding: 0.6rem;
        font-size: 1.25rem;
        transition: opacity 1s;
    }

    #login .update .vignette .title {
        font-size: 1.5rem;
        color: #fba44a;
        font-weight: 600;
    }

    #login .update .vignette .description {
        font-size: 0.9rem;
        font-weight: 400;
        color: rgb(198, 198, 198);
    }

    #login .update .progress-bar {
        width: 100%;
        height: 0.5rem;
        background: rgba(90, 90, 90, 0.615);
        margin-top: 0.5rem;
        border-radius: 0.25rem;
        /* overflow: hidden; */
    }

    #login .update .progress-bar .progress {
        height: 100%;
        background: linear-gradient(90deg, #ffab48 0.01%, #fc8c5b 100%);
        border-radius: 0.25rem;
        transition: width 10s cubic-bezier(0.2, 0.2, 0.2, 0.2);
        box-shadow: 0 0 2rem 2rem #ffaa4845;
    }

    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 200% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    .flip {
        animation: flip 0.5s;
    }

    @keyframes flip {
        0% {
            transform: rotateY(0deg);
        }

        50% {
            transform: rotateY(90deg);
        }

        50.1% {
            transform: rotateY(-90deg);
        }

        100% {
            transform: rotateY(0deg);
        }
    }

    #login #rules {
        display: flex;
        flex-direction: column;
        align-items: start;
        gap: 0.2rem;
        max-width: 35rem;
        padding-right: 0.5rem;
    }

    /* better scroll in rules */
    #login #rules::-webkit-scrollbar {
        width: 0.5rem;
    }

    #login #rules::-webkit-scrollbar-thumb {
        background: #575757;
        border-radius: 0.25rem;
    }

    #login #rules::-webkit-scrollbar-track {
        background: #282828;
        border-radius: 0.25rem;
    }

    #login #rules h2 {
        font-size: 2rem;
        font-weight: 600;
        color: #fba44a;
        margin-bottom: 0.125rem;
        margin-top: 0;
    }

    #login #rules h3 {
        font-size: 1.4rem;
        font-weight: 600;
        color: #e7e7e7;
        margin-bottom: 0.125rem;
        margin-top: 0.625rem;
    }

    #login #rules span {
        font-size: 0.9rem;
        color: #c1c1c1;
        margin-bottom: 0;
    }

    #login:has(.flip) {
        transform-style: preserve-3d;
        perspective: 75rem;
    }

    #login .size-button {
        background: #2a2a2a;
        border: 0.125rem solid #3d3d3d;
        color: #ffffff;
        padding: 0.5rem;
        border-radius: 2rem;
        cursor: pointer;
        width: 1rem;
        height: 1rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>

<div class="d-flex flex-column gap-3" id="login-panel">
    <div class="d-flex gap-3">
        <div class="login-panel rounded-2 hidden" id="rules-view">
            <div id="rules" style="max-height: 20rem; overflow-y: scroll;">
                <h2>Regulamin</h2>
                <h3>§1. Lorem ipsum</h3>
                <span>1.1. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>1.2. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>1.3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>1.4. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
        
                <h3>§2. Lorem ipsum</h3>
                <span>2.1. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>2.2. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>2.3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>2.4. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
        
                <h3>§3. Lorem ipsum</h3>
                <span>3.1. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.2. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.4. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
        
                <h3>§3. Lorem ipsum</h3>
                <span>3.1. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.2. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.4. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
        
                <h3>§3. Lorem ipsum</h3>
                <span>3.1. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.2. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.3. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
                <span>3.4. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam</span>
            </div>
    
            <div class="d-flex justify-center w-100 mt-2 hoverable" onclick="login_toggleLoginView('register-view')">
                <div class="nice-button button-sm">Powrót</div>
            </div>
        </div>
    
        <div class="login-panel rounded-2" id="login-view">
            <div class="logo" style="margin-right: 1.25rem;">
                <img src="/m-login/data/logo.png" style="width: 8.125rem;">
                <span>
                    <span>district</span><span class="text-glow-bit">district</span><span class="gradient-text">MTA</span>
                    <span class="gradient-text text-glow">MTA</span>
                </span>
            </div>

            <div class="nice-input">
                <div class="input">
                    <input type="text" name="login" id="login-i" placeholder="Login">
                </div>
                <div class="nice-input-bar"></div>
            </div>
        
            <div class="nice-input">
                <div class="input">
                    <input type="password" name="password" id="password" placeholder="Hasło">
                    <div class="hidden" id="password-toggle-hide" class="hoverable" onclick="login_togglePassword('login-view')"><svg width="1.25rem" height="1.25rem" style="width: 1.25rem !important; height: 1.25rem !important; scale: 1.5;" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"/><path d="M3,12 C3,12 5.45454545,6 12,6 C16.9090909,6 21,12 21,12 C21,12 16.9090909,18 12,18 C5.45454545,18 3,12 3,12 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><path d="M12,15 C10.3431458,15 9,13.6568542 9,12 C9,10.3431458 10.3431458,9 12,9 C13.6568542,9 15,10.3431458 15,12 C15,13.6568542 13.6568542,15 12,15 Z" fill="white" opacity="0.3"/></g></svg></div>
                    <div id="password-toggle-show" class="hoverable" onclick="login_togglePassword('login-view')"><svg width="1.25rem" height="1.25rem" style="width: 1.25rem !important; height: 1.25rem !important; scale: 1.5;" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"/><path d="M19.2078777,9.84836149 C20.3303823,11.0178941 21,12 21,12 C21,12 16.9090909,18 12,18 C11.6893441,18 11.3879033,17.9864845 11.0955026,17.9607365 L19.2078777,9.84836149 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><path d="M14.5051465,6.49485351 L12,9 C10.3431458,9 9,10.3431458 9,12 L5.52661464,15.4733854 C3.75006453,13.8334911 3,12 3,12 C3,12 5.45454545,6 12,6 C12.8665422,6 13.7075911,6.18695134 14.5051465,6.49485351 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><rect fill="white" opacity="0.3" transform="translate(12.524621, 12.424621) rotate(-45.000000) translate(-12.524621, -12.424621) " x="3.02462111" y="11.4246212" width="19" height="2"/></g></svg></div>
                </div>
                <div class="nice-input-bar"></div>
            </div>
        
            <div class="switch-box" style="margin-left: 0.625rem; margin-right: auto;" tabindex="0" onclick="this.classList.toggle('switched');" onkeydown="if (event.key === 'Enter' || event.key === ' ') this.classList.toggle('switched');">
                <div class="switch">
                    <div class="inner"></div>
                </div>
                <div class="label">
                    <span>Zapamiętaj moje dane!</span>
                    <span>Dzięki temu zalogujesz się szybciej!</span>
                </div>
            </div>
        
            <div class="nice-button" tabindex="0" style="width: calc(100% - 3.8rem);" onclick="login_login(this)" onkeydown="if (event.key === 'Enter' || event.key === ' ') login_login(this)">Zaloguj się</div>
        
            <span class="d-flex flex-column text-center gap-1">
                <span style="color: rgba(255, 255, 255, 0.65); font-size: 0.875rem;">
                    Nie posiadasz swojego konta? Załóż je już teraz!
                </span>
                <span style="color: #fba44a; font-size: 0.813rem; font-weight: 600;" class="hoverable" onclick="login_toggleLoginView('register-view')">
                    <span class="gradient-text">Kliknij tutaj</span>
                    <span class="gradient-text text-glow" style="filter: blur(0.625rem); opacity: 0.6;">Kliknij tutaj</span>
                </span>
            </span>
        </div>
        <div class="login-panel rounded-2 hidden" id="register-view">
            <div class="logo" style="margin-right: 1.25rem;">
                <img src="/m-login/data/logo.png" style="width: 8.125rem;">
                <span>
                    <span>district</span><span class="text-glow-bit">district</span><span class="gradient-text">MTA</span>
                    <span class="gradient-text text-glow">MTA</span>
                </span>
            </div>
        
            <div class="nice-input">
                <div class="input">
                    <input type="text" name="email" id="email" placeholder="Adres email">
                </div>
                <div class="nice-input-bar"></div>
            </div>
    
            <div class="nice-input">
                <div class="input">
                    <input type="text" name="login" id="login-i-r" placeholder="Login">
                </div>
                <div class="nice-input-bar"></div>
            </div>
        
            <div class="nice-input">
                <div class="input">
                    <input type="password" name="password" id="password-r" placeholder="Hasło">
                    <div class="hidden" id="password-toggle-hide" class="hoverable" onclick="login_togglePassword('register-view')"><svg width="1.25rem" height="1.25rem" style="width: 1.25rem !important; height: 1.25rem !important; scale: 1.5;" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"/><path d="M3,12 C3,12 5.45454545,6 12,6 C16.9090909,6 21,12 21,12 C21,12 16.9090909,18 12,18 C5.45454545,18 3,12 3,12 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><path d="M12,15 C10.3431458,15 9,13.6568542 9,12 C9,10.3431458 10.3431458,9 12,9 C13.6568542,9 15,10.3431458 15,12 C15,13.6568542 13.6568542,15 12,15 Z" fill="white" opacity="0.3"/></g></svg></div>
                    <div id="password-toggle-show" class="hoverable" onclick="login_togglePassword('register-view')"><svg width="1.25rem" height="1.25rem" style="width: 1.25rem !important; height: 1.25rem !important; scale: 1.5;" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"/><path d="M19.2078777,9.84836149 C20.3303823,11.0178941 21,12 21,12 C21,12 16.9090909,18 12,18 C11.6893441,18 11.3879033,17.9864845 11.0955026,17.9607365 L19.2078777,9.84836149 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><path d="M14.5051465,6.49485351 L12,9 C10.3431458,9 9,10.3431458 9,12 L5.52661464,15.4733854 C3.75006453,13.8334911 3,12 3,12 C3,12 5.45454545,6 12,6 C12.8665422,6 13.7075911,6.18695134 14.5051465,6.49485351 Z" fill="white" fill-rule="nonzero" opacity="0.3"/><rect fill="white" opacity="0.3" transform="translate(12.524621, 12.424621) rotate(-45.000000) translate(-12.524621, -12.424621) " x="3.02462111" y="11.4246212" width="19" height="2"/></g></svg></div>
                </div>
                <div class="nice-input-bar"></div>
            </div>
        
            <div class="switch-box" style="margin-left: 0.625rem; margin-right: auto;">
                <div class="switch" onclick="this.parentElement.classList.toggle('switched');" tabindex="0" onkeydown="if (event.key === 'Enter' || event.key === ' ') this.parentElement.classList.toggle('switched');">
                    <div class="inner"></div>
                </div>
                <div class="label">
                    <span>Akceptuję<span class="gradient-text hoverable" onclick="login_toggleLoginView('rules-view');">regulamin</span> serwera!</span>
                </div>
            </div>
        
            <div class="nice-button" style="width: calc(100% - 3.8rem);" onclick="login_register(this)" tabindex="0" onkeydown="if (event.key === 'Enter' || event.key === ' ') login_register(this)">Zarejestruj się</div>
        
            <span class="d-flex flex-column text-center gap-1">
                <span style="color: rgba(255, 255, 255, 0.65); font-size: 0.875rem;">
                    Nie posiadasz swojego konta? Załóż je już teraz!
                </span>
                <span style="color: #fba44a; font-size: 0.813rem; font-weight: 600;" onclick="login_toggleLoginView('login-view')">
                    <span class="gradient-text">Kliknij tutaj</span>
                    <span class="gradient-text text-glow" style="filter: blur(0.625rem); opacity: 0.6;">Kliknij tutaj</span>
                </span>
            </span>
        </div>
        <div class="update d-flex justify-center align-items-center rounded-2" id="update">Ładowanie aktualizacji...</div>
    </div>

    <div class="d-flex justify-center align-items-center" style="color: #cdcdcd; font-weight: bold;">
        <div class="d-flex gap-3 align-items-center position-absolute mt-4">
            <span class="size-button hoverable" onclick="changeRemSize(-0.5)">-</span>
            <span>Wielkość interfejsu</span>
            <span class="size-button hoverable" onclick="changeRemSize(0.5)">+</span>
        </div>
    </div>
</div>

<script>
    let updatesData = [];
    window.login_waiting = false;

    window.login_login = async (button) => {
        if (isButtonSpinner(button)) return;
        
        makeButtonSpinner(button);

        let login = document.querySelector('#login-view #login-i').value;
        let password = document.querySelector('#login-view #password').value;

        let data = await mta.fetch('login', 'login', [login, password]);

        if (data == null) {
            notis_addNotification('error', 'Błąd', 'Połączenie przekroczyło czas oczekiwania');
        } else {
            notis_addNotification(data.status, data.title, data.message);

            if (data.status == 'success') {
                login_hideLoginPanel();
                return;
            }
        }

        makeButtonSpinner(button, false);
    }

    window.login_register = async (button) => {
        if (isButtonSpinner(button)) return;
        
        makeButtonSpinner(button);

        let accept = document.querySelector('#register-view .switch-box').classList.contains('switched');
        if (!accept) {
            makeButtonSpinner(button, false);
            notis_addNotification('error', 'Rejestracja', 'Musisz zaakceptować regulamin serwera!')
            return;
        }

        let email = document.querySelector('#register-view #email').value;
        let login = document.querySelector('#register-view #login-i-r').value;
        let password = document.querySelector('#register-view #password-r').value;

        let data = await mta.fetch('login', 'register', [email, login, password]);
        
        if (data == null) {
            notis_addNotification('error', 'Błąd', 'Połączenie przekroczyło czas oczekiwania');
        } else {
            notis_addNotification(data.status, data.title, data.message);
            
            if (data.status == 'success') {
                login_toggleLoginView('login-view');

                document.querySelector('#login-view #login-i').value = login;
                document.querySelector('#login-view #password').value = password;
            }
        }

        makeButtonSpinner(button, false);
    }

    window.login_togglePassword = (view) => {
        let passwordInput = document.querySelector(`#${view} #password`);
        let passwordToggleHide = document.querySelector(`#${view} #password-toggle-hide`);
        let passwordToggleShow = document.querySelector(`#${view} #password-toggle-show`);
        if (!passwordInput) passwordInput = document.querySelector(`#${view} #password-r`);

        passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordToggleHide.classList.toggle('hidden');
        passwordToggleShow.classList.toggle('hidden');
    }

    window.login_hideLoginPanelInner = () => {
        let remember = document.querySelector('#login-view .switch-box').classList.contains('switched');
        let login = document.querySelector('#login-view #login-i').value;
        let password = document.querySelector('#login-view #password').value;
        mta.triggerEvent('login:hideLoginPanel', remember, login, password);
    }

    window.login_hideLoginPanel = () => {
        document.querySelector('#login-panel').classList.add('go-hide');
        setTimer('login', login_hideLoginPanelInner, 500);
    }

    function login_toggleLoginViewFlip(target) {
        let loginView = document.querySelector('#login-view');
        let registerView = document.querySelector('#register-view');
        let rulesView = document.querySelector('#rules-view');

        loginView.classList.toggle('hidden', target !== 'login-view');
        registerView.classList.toggle('hidden', target !== 'register-view');
        rulesView.classList.toggle('hidden', target !== 'rules-view');
    }

    function login_removeFlip() {
        document.querySelector('#login #login-panel').classList.remove('flip');
    }

    window.login_toggleLoginView = (target) => {
        document.querySelector('#login #login-panel').classList.add('flip');
        setTimer('login', login_toggleLoginViewFlip, 250, target);
        setTimer('login', login_removeFlip, 500);
    }

    function login_setProgress(progress) {
        let updateScreen = document.querySelector('#login #update');
        updateScreen.querySelectorAll('.progress').forEach((progressBar) => {
            progressBar.style.width = progress + '%';
        });
    }

    function login_changeUpdateImages() {
        let updateScreen = document.querySelector('#login #update');
        let update1 = updateScreen.querySelector('#update-0');
        let update2 = updateScreen.querySelector('#update-1');

        update1.style.opacity = 1;
        update2.style.opacity = 0;
    }

    async function login_changeUpdate(update) {
        let nextUpdate = updatesData[update.id + 1];
        if (!nextUpdate) {
            nextUpdate = updatesData[0];
        }

        let id = 0;

        let renderUpdate = (update) => {
            let image = '/m-updates/' + update.image;
            return `
                <div class="vignette position-absolute" style="left: 0; top: 0; opacity: ${id};" id="update-${id++}">
                    <div style="background-image: url(${image}); width: 100%; height: 100%; position: absolute; top: 0; left: 0;" class="image" id="update-image">
                        <div class="vignette"></div>
                    </div>

                    <span class="title position-relative" style="width: calc(100% - 1.5rem);">${update.title}</span>
                    <span class="description position-relative" style="width: calc(100% - 1.5rem);">${update.description}</span>
                    <div class="progress-bar position-relative" style="height: 0.5rem; margin-block: 1.25rem 0.6rem; width: calc(100% - 1.5rem); transform: translateY(-0.625rem);">
                        <div class="progress" style="width: 0%;"></div>
                    </div>
                </div>
            `;
        }
        
        let updateScreen = document.querySelector('#login #update');
        let nextImage = '/m-updates/' + nextUpdate.image;
        updateScreen.innerHTML = `
            ${renderUpdate(nextUpdate)}
            ${renderUpdate(update)}
        `;

        setTimer('login', login_setProgress, 100, 100);
        setTimer('login', login_changeUpdateImages, 10000 - 1000);
        setTimer('login', login_changeUpdate, 10000, nextUpdate);
    }

    addEvent('login', 'interface:data:updates', (updates) => {
        updatesData = updates[0];
        for (let i = 0; i < updatesData.length; i++) {
            updatesData[i].id = i;
        }

        let firstUpdate = updatesData[0];
        login_changeUpdate(firstUpdate);
    });

    addEvent('login', 'interface:data:login-cached', (data) => {
        let login = data[0].login;
        let password = data[0].password;

        document.querySelector('#login-view #login-i').value = login;
        document.querySelector('#login-view #password').value = password;
        document.querySelector('#login-view .switch-box').classList.add('switched');
    });
</script>