componentsPositions = {
    [400] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -1.83333, 0.76667),
            scale = Vector3(1.00000, 1.00000, 1.00000)
        },
    },
    [401] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, -0.00000),
            scale = Vector3(1.16000, 1.17000, 1.17000)
        },
    },
    [402] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.26667, -0.00000),
            scale = Vector3(1.17000, 1.19000, 1.19000)
        },
    },
    [404] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.06667, 0.90000),
            scale = Vector3(0.98000, 1.19000, 1.19000)
        },
    },
    [405] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.60000, -0.03333),
            scale = Vector3(1.06000, 1.06000, 1.06000)
        },
    },
    [409] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.76667, -0.00000),
            scale = Vector3(1.02000, 1.03000, 1.03000)
        },
    },
    [410] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, 0.03333),
            scale = Vector3(1.07000, 1.03000, 1.03000)
        },
    },
    [411] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.26667, 0.23333),
            scale = Vector3(1.25000, 1.25000, 1.25000)
        },
    },
    [412] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -1.40000, -0.00000),
            scale = Vector3(0.95000, 0.95000, 0.95000)
        },
    },
    [415] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.26667, 0.23333),
            scale = Vector3(0.85000, 0.85000, 0.85000)
        },
    },
    [418] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.03333, 0.96667),
            scale = Vector3(1.10000, 1.10000, 1.10000)
        },
    },
    [419] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.83333, -0.06667),
            scale = Vector3(1.22000, 1.10000, 1.10000)
        },
    },
    [420] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, -0.00000),
            scale = Vector3(1.22000, 1.22000, 1.22000)
        },
    },
    [421] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.60000, -0.06667),
            scale = Vector3(0.97000, 0.97000, 0.98000)
        },
    },
    [422] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -0.16667, 0.76667),
            scale = Vector3(1.10000, 1.10000, 1.10000)
        },
    },
    [426] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.50000, -0.00000),
            scale = Vector3(1.21000, 1.21000, 1.21000)
        },
    },
    [429] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.50000, -0.00000),
            scale = Vector3(0.73000, 0.73000, 0.73000)
        },
    },
    [434] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.50000, -0.06667),
            scale = Vector3(0.76000, 0.77000, 0.77000)
        },
    },
    [436] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.50000, -0.00000),
            scale = Vector3(1.08000, 1.08000, 1.09000)
        },
    },
    [438] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.66667, -0.03333),
            scale = Vector3(0.95000, 1.00000, 1.01000)
        },
    },
    [439] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, -0.00000),
            scale = Vector3(1.10000, 1.10000, 1.10000)
        },
    },
    [442] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.73333, 0.86667),
            scale = Vector3(1.10000, 1.10000, 1.10000)
        },
    },
    [445] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.56667, -0.00000),
            scale = Vector3(1.10000, 1.10000, 1.10000)
        },
    },
    [451] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.33333, 0.16667),
            scale = Vector3(1.33000, 1.33000, 1.33000)
        },
    },
    [458] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.26667, 0.66667),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [466] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.96667, -0.03333),
            scale = Vector3(1.03000, 1.03000, 1.03000)
        },
    },
    [467] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.96667, -0.03333),
            scale = Vector3(0.94000, 0.99000, 0.99000)
        },
    },
    [474] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.43333, -0.03333),
            scale = Vector3(1.10000, 1.10000, 1.11000)
        },
    },
    [475] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.66667, -0.10000),
            scale = Vector3(1.10000, 1.10000, 1.11000)
        },
    },
    [477] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.43333, 0.26667),
            scale = Vector3(1.29000, 1.29000, 1.29000)
        },
    },
    [478] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -1.50000, 1.36667),
            scale = Vector3(1.04000, 1.29000, 1.29000)
        },
    },
    [479] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.26667, 0.93333),
            scale = Vector3(1.00000, 1.00000, 1.00000)
        },
    },
    [480] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.86667, -0.10000),
            scale = Vector3(0.87000, 0.87000, 0.87000)
        },
    },
    [483] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.40000, 1.00000),
            scale = Vector3(0.93000, 0.93000, 0.93000)
        },
    },
    [489] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.16667, 1.03333),
            scale = Vector3(1.15000, 1.15000, 1.15000)
        },
    },
    [490] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.80000, 1.03333),
            scale = Vector3(1.15000, 1.15000, 1.15000)
        },
    },
    [491] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.63333, -0.00000),
            scale = Vector3(0.94000, 0.94000, 0.94000)
        },
    },
    [492] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.50000, 0.03333),
            scale = Vector3(1.01000, 1.03000, 1.03000)
        },
    },
    [495] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -1.76667, 0.96667),
            scale = Vector3(1.21000, 1.21000, 1.21000)
        },
    },
    [496] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.86667, -0.30000),
            scale = Vector3(1.03000, 1.03000, 1.03000)
        },
    },
    [504] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.86667, -0.03333),
            scale = Vector3(1.03000, 1.03000, 1.03000)
        },
    },
    [505] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.16667, 1.03333),
            scale = Vector3(1.19000, 1.19000, 1.19000)
        },
    },
    [506] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.53333, 0.06667),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [507] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.83333, -0.00000),
            scale = Vector3(1.24000, 1.25000, 1.25000)
        },
    },
    [516] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.66667, -0.00000),
            scale = Vector3(1.15000, 1.17000, 1.17000)
        },
    },
    [517] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.96667, -0.03333),
            scale = Vector3(1.19000, 1.20000, 1.21000)
        },
    },
    [518] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.70000, -0.06667),
            scale = Vector3(1.11000, 1.11000, 1.12000)
        },
    },
    [526] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.33333, -0.00000),
            scale = Vector3(1.11000, 1.12000, 1.13000)
        },
    },
    [527] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.40000, -0.03333),
            scale = Vector3(1.02000, 1.02000, 1.03000)
        },
    },
    [529] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, 0.03333),
            scale = Vector3(1.31000, 1.31000, 1.31000)
        },
    },
    [533] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.63333, 0.03333),
            scale = Vector3(1.07000, 1.07000, 1.06000)
        },
    },
    [534] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.96667, -0.03333),
            scale = Vector3(1.17000, 1.18000, 1.18000)
        },
    },
    [536] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.73333, -0.03333),
            scale = Vector3(1.04000, 1.04000, 1.04000)
        },
    },
    [540] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.46667, 0.03333),
            scale = Vector3(1.17000, 1.17000, 1.17000)
        },
    },
    [542] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -4.26667, 0.73333),
            scale = Vector3(1.09000, 1.09000, 1.10000)
        },
    },
    [546] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.60000, 0.03333),
            scale = Vector3(1.26000, 1.27000, 1.27000)
        },
    },
    [547] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.66667, -0.03333),
            scale = Vector3(1.13000, 1.13000, 1.13000)
        },
    },
    [549] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.76667, -0.03333),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [550] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.66667, -0.00000),
            scale = Vector3(1.11000, 1.11000, 1.11000)
        },
    },
    [558] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -1.16667, -0.33333),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [559] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -1.26667, -0.26667),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [560] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.53333, -0.00000),
            scale = Vector3(1.06000, 1.07000, 1.07000)
        },
    },
    [561] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.00000, 0.76667),
            scale = Vector3(0.87000, 0.87000, 0.88000)
        },
    },
    [562] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.53333, -0.00000),
            scale = Vector3(1.05000, 1.05000, 1.05000)
        },
    },
    [565] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, 0.16667, -0.00000),
            scale = Vector3(0.93000, 0.93000, 0.93000)
        },
    },
    [566] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.70000, -0.03333),
            scale = Vector3(1.08000, 1.08000, 1.09000)
        },
    },
    [567] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -1.13333, -0.00000),
            scale = Vector3(1.11000, 1.11000, 1.12000)
        },
    },
    [575] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.26667, -0.06667),
            scale = Vector3(1.11000, 1.11000, 1.12000)
        },
    },
    [576] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -1.00000, -0.00000),
            scale = Vector3(0.79000, 0.79000, 0.79000)
        },
    },
    [579] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.26667, 1.20000),
            scale = Vector3(1.15000, 1.15000, 1.16000)
        },
    },
    [580] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -2.60000, 0.43333),
            scale = Vector3(1.30000, 1.30000, 1.30000)
        },
    },
    [585] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.36667, -0.00000),
            scale = Vector3(1.21000, 1.21000, 1.21000)
        },
    },
    [587] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.36667, 0.03333),
            scale = Vector3(1.03000, 1.03000, 1.03000)
        },
    },
    [589] = {
        ["spoiler"] = {
            component = "chassis",
            position = Vector3(0.00000, -1.86667, 1.03333),
            scale = Vector3(0.96000, 0.96000, 0.96000)
        },
    },
    [596] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.43333, -0.00000),
            scale = Vector3(1.23000, 1.24000, 1.24000)
        },
    },
    [597] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.43333, -0.00000),
            scale = Vector3(1.23000, 1.24000, 1.24000)
        },
    },
    [598] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.73333, -0.03333),
            scale = Vector3(1.23000, 1.24000, 1.24000)
        },
    },
    [602] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.30000, 0.03333),
            scale = Vector3(1.00000, 1.01000, 1.01000)
        },
    },
    [603] = {
        ["spoiler"] = {
            component = "boot_dummy",
            position = Vector3(0.00000, -0.63333, -0.10000),
            scale = Vector3(0.92000, 0.92000, 0.93000)
        },
    }
}

upgrades = {
    ['tuning/spoiler'] = 'spoiler',
}

upgradesOriginalSlots = {
    spoiler = 2,
}

publicUpgrades = {
    spoiler = {
        'tuning/spoiler',
    }
}

componentsChecks = {
    boot_dummy = function(vehicle)
        return getVehicleDoorState(vehicle, 1) ~= 4
    end
}

local _getVehicleCompatibleUpgrades = getVehicleCompatibleUpgrades
local _getVehicleUpgradeOnSlot = getVehicleUpgradeOnSlot
local _getVehicleUpgrades = getVehicleUpgrades

function getUpgradeSlotByModel(model)
    return upgrades[model]
end

function getVehicleOriginalUpgradeOnSlot(vehicle, name)
    local slotId = upgradesOriginalSlots[name]
    if not slotId then
        return false
    end

    local upgrade = _getVehicleUpgradeOnSlot(vehicle, slotId)
    return (upgrade and upgrade ~= 0) and upgrade or false
end

function getVehicleCustomUpgrades(vehicle)
    local parts = getElementData(vehicle, 'vehicle:custom-upgrades') or {}
    return parts
end

function getOriginalUpgradeSlotName(upgrade)
    return getVehicleUpgradeSlotName(upgrade):lower()
end

function getVehicleCustomUpgradeOnSlot(vehicle, slotName)
    local parts = getVehicleCustomUpgrades(vehicle)
    return parts[slotName]
end

function getVehicleUpgradeOnSlot(vehicle, slotName)
    local upgrade = getVehicleCustomUpgradeOnSlot(vehicle, slotName)
    if not upgrade then
        upgrade = getVehicleOriginalUpgradeOnSlot(vehicle, slotName)
    end

    return upgrade
end

function getVehicleCustomCompatibleUpgrades(vehicle, slotName)
    local parts = getVehicleCustomUpgrades(vehicle)
    local vehicleModel = getElementModel(vehicle)
    local compatibleUpgrades = {}

    for slot, upgrades in pairs(publicUpgrades) do
        local componentData = componentsPositions[vehicleModel][slot]
        if componentData then
            for _, upgrade in ipairs(upgrades) do
                table.insert(compatibleUpgrades, upgrade)
            end
        end
    end

    return compatibleUpgrades
end

local function unique(array)
    local seen = {}
    local result = {}

    for _, value in ipairs(array) do
        if not seen[value] then
            table.insert(result, value)
            seen[value] = true
        end
    end

    return result
end

function getVehicleCompatibleUpgrades(vehicle, slotName)
    local slotId = upgradesOriginalSlots[slotName]
    local upgrades = {}

    if slotId then
        upgrades = _getVehicleCompatibleUpgrades(vehicle, slotId)
    end

    local customUpgrades = getVehicleCustomCompatibleUpgrades(vehicle, slotName)
    for _, upgrade in ipairs(customUpgrades) do
        table.insert(upgrades, upgrade)
    end

    return unique(upgrades)
end

function getVehicleUpgrades(vehicle)
    local upgrades = {}
    
    for slot, slotId in pairs(upgradesOriginalSlots) do
        local upgrade = _getVehicleUpgradeOnSlot(vehicle, slotId)
        if upgrade and upgrade ~= 0 then
            table.insert(upgrades, upgrade)
        end
    end

    local customUpgrades = getVehicleCustomUpgrades(vehicle)
    for _, upgrade in pairs(customUpgrades) do
        table.insert(upgrades, upgrade)
    end

    return upgrades
end